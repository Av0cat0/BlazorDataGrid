@page "/tabledata"
@using UITable3.Shared
@inject HttpClient Http
@inject DialogService DialogService

@if (tasks == null)
{
    <RadzenButton Click=@(args => GetData()) Text="Load Data" ButtonStyle="ButtonStyle.Light" />
}
else
{
    <RadzenDataGrid @ref="tasksGrid" AllowFiltering="true" FilterMode="FilterMode.Simple" AllowPaging="true" PageSize="10" AllowSorting="true"
                    Data="@tasks" ColumnWidth="140px" TItem="TableData">
        <Columns>
            <RadzenDataGridColumn Width="50px" TItem="TableData" Title="#" Filterable="false" Sortable="false" TextAlign="TextAlign.Center">
                <Template Context="data">
                    @(tasks.IndexOf(data) + 1)
                </Template>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="TableData" Property="ActivityName" Title="Name" />
            <RadzenDataGridColumn TItem="TableData" Property="ActivityDescription" Title="Description" />
            <RadzenDataGridColumn TItem="TableData" Property="ActivityContext" Title="Context" />
            <RadzenDataGridColumn Width="150px" TItem="TableData" Property="Status" Title="Status">
                <Template Context="data">
                    <RadzenButton ButtonStyle=@(StatusBtnStyle(data.Status)) class="status-btn" Text="@data.Status" Click=@ShowInlineDialog />
                </Template>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="TableData" Property="ServiceUserId" Title="Assigned To">
                <Template Context="data">
                    <RadzenImage Path=@(data.Photo) style="width: 40px; height: 40px; border-radius: 6px; float: left;" />
                </Template>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="TableData" Property="CreatedDate" Title="Start Date" FormatString="{0:d}" />
            <RadzenDataGridColumn TItem="TableData" Property="DueDate" Title="Due Date" FormatString="{0:d}" />
            <RadzenDataGridColumn Width="150px" TItem="TableData" Property="Priority" Title="Priority">
                <Template Context="data">
                    <RadzenButton ButtonStyle=@(PriorityBtnStyle(data.Priority)) Class="Status-btn"  Text="@data.Priority" />
                </Template>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn Width="150px" TItem="TableData" Property="WorkFlowStep" Title="Process Status">
                <Template Context="data">
                    <RadzenButton ButtonStyle="ButtonStyle.Info" Icon="info" Class="m-1" Text="@data.WorkFlowStep" />
                </Template>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="TableData" Property="Data1" Title="Data1" />
            <RadzenDataGridColumn TItem="TableData" Property="Data2" Title="Data2" />
        </Columns>
    </RadzenDataGrid>
}
@code {
    RadzenDataGrid<TableData> tasksGrid;
    IList<TableData> tasks;

    protected override void OnInitialized()
    {
        //tasks = Http.GetFromJsonAsync<TableData[]>("TableData");
    }
    private async Task GetData()
    {
        tasks = await Http.GetFromJsonAsync<TableData[]>("TableData");
    }
    private ButtonStyle StatusBtnStyle(string status)
    {
        switch (status)
        {
            case "Draft":
                return ButtonStyle.Secondary;

            case "Active":
                return ButtonStyle.Info;

            case "Closed":
                return ButtonStyle.Success;

            case "Cancelled":
                return ButtonStyle.Warning;

            case "Deleted":
                return ButtonStyle.Danger;

            default:
                return ButtonStyle.Danger;
        }
    }
    private ButtonStyle PriorityBtnStyle(string priority)
    {
        switch (priority)
        {
            case "Critical":
                return ButtonStyle.Danger;

            case "High":
                return ButtonStyle.Warning;

            case "Medium":
                return ButtonStyle.Success;

            case "Low":
                return ButtonStyle.Info;

            default:
                return ButtonStyle.Danger;
        }
    }

    async Task ShowInlineDialog()
    {
     var result = await DialogService.OpenAsync("Simple Dialog", ds =>
        @<div>
                <div class="col">
                    <RadzenButton Text="Ok" Click="() => ds.Close(true)" Class="mr-1" Style="width: 80px;" />
                    <RadzenButton Text="Cancel" Click="() => ds.Close(false)" ButtonStyle="ButtonStyle.Secondary" Class="mr-1" />
                    <RadzenButton Text="Refresh" Click="() => ds.Refresh() " ButtonStyle="ButtonStyle.Light"  Class="mr-1 float-right" />          
                </div>
        </div>);
    
    }
//ContextMenu=@(args => ShowContextMenuWithItems(args))
}

